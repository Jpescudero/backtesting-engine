RAÍZ DEL PROYECTO
-----------------
Repositorio GitHub (remoto):
  https://github.com/Jpescudero/backtesting-engine

Carpeta local típica:
  C:\Users\JorgeP\OneDrive\Bolsa\Scripts\10. Backtesting\


EJECUTABLE PRINCIPAL
--------------------
main.py
  # Punto de entrada: orquesta todo el pipeline, lanza backtests
  # de Microstructure Reversal (default) o Microstructure Sweep y genera:
  #   - Excel + JSON con resumen del backtest
  #   - PNG con mejores/peores trades
  #   - Permite seleccionar años de train/test y capital inicial
  #   - Selector --strategy y flags avanzados (ATR timeframe, volumen, etc.)
  GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/main.py

run_settings.example.txt
  # Plantilla de configuración key=value para main.py
  #   - initial_cash=... (capital inicial)
  #   - train_years=2020,2021 (años de entrenamiento)
  #   - test_years=2022,2023 (años de prueba)
  #   - use_test_years=True/False (usar años de test o train)
  #   - strategy=microstructure_sweep (para cambiar desde Microstructure Reversal)
  #   - sweep_lookback=..., min_sweep_break_atr=..., etc. (parámetros opcionales)
  # Copia este archivo y pásalo a main.py con --config-file

.pre-commit-config.yaml
  # Hooks locales: Ruff (lint + format), Black, isort y fixes básicos de whitespace
  # Ejecuta `pre-commit install` tras clonar para aplicarlos automáticamente

.github/workflows/ci.yml
  # Pipeline de CI (GitHub Actions): Ruff, Black, isort, mypy y pytest con cobertura
  # Publica coverage.xml como artefacto y falla si la cobertura baja del 80 %

pyproject.toml
  # Configuración centralizada de Black, Ruff (isort), isort, mypy y coverage


CÓDIGO FUENTE
-------------
src\
  config\
    # Configuración general del proyecto

    paths.py
      # GPS de rutas (PROJECT_ROOT, DATA_DIR, REPORTS_DIR, etc.)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/config/paths.py

  pipeline\
    # Helpers de orquestación (preparación de datos, backtests y reporting)

    __init__.py
      # Facilita importaciones del paquete de pipeline

    data_pipeline.py
      # Asegura que existan los artefactos ticks → CSV → NPZ
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/pipeline/data_pipeline.py

    backtest_runner.py
      # Ejecuta estrategia + motor + reporting en una sola llamada
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/pipeline/backtest_runner.py

    reporting.py
      # Helpers para exportar métricas, plots y ficheros finales
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/pipeline/reporting.py

  data\
    # Todo lo relacionado con carga y transformación de datos

    data_utils.py
      # helpers: iter_ticks_by_year, make_ohlcv, list_tick_files...
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/data/data_utils.py

    data_to_parquet.py
      # Darwinex BID/ASK -> ticks en parquet (por símbolo/año/hora)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/data/data_to_parquet.py

    bars1m_to_excel.py
      # ticks parquet -> barras 1m CSV (todos los años)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/data/bars1m_to_excel.py

    csv_1m_to_npz.py
      # CSV barras 1m -> NPZ (ts, o, h, l, c, v)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/data/csv_1m_to_npz.py

    parquet_to_npz.py
      # barras parquet -> NPZ (función genérica bars_df_to_npz_arrays)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/data/parquet_to_npz.py

    feeds.py
      # NPZOHLCVFeed (carga NPZ -> OHLCVArrays para Numba)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/data/feeds.py

  engine\
    # Motor de backtesting (Numba, señales, SL/TP, etc.)

    core.py
      # BacktestConfig, BacktestResult, motor numba, run_backtest_with_signals
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/engine/core.py

  analytics\
    # Métricas, reporting y plots

    metrics.py
      # equity_curve_metrics, trades_metrics (estilo Darwinex)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/analytics/metrics.py

    reporting.py
      # equity_to_series, trades_to_dataframe
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/analytics/reporting.py

    plots.py
      # plot_equity_curve, plot_trades_per_month, etc.
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/analytics/plots.py

    backtest_output.py
      # helpers para guardar resumen (equity/trades/estadísticas) a Excel/JSON
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/analytics/backtest_output.py

    trade_plots.py
      # plots de mejores/peores trades sobre barras 1m (entrada/salida marcadas)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/analytics/trade_plots.py

  strategies\
    # Estrategias concretas

    barrida_apertura.py
      # Estrategia de "barrida" en apertura (9:00 y 15:00, hora Europa/Madrid)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/strategies/barrida_apertura.py

    microstructure_reversal.py
      # Estrategia de reversión microestructural (pullbacks, break de estructura, etc.)
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/strategies/microstructure_reversal.py

    microstructure_sweep.py
      # Estrategia de "sweep" + absorción: barridas de mínimos con mecha larga,
      # confirmación de vela siguiente, filtros de volumen relativo/percentiles,
      # ventanas intradía, límite de trades/día y SL/TP basados en ATR
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/strategies/microstructure_sweep.py

    base.py
      # Clases base y tipos comunes para estrategias
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/strategies/base.py

    # GitHub (carpeta): https://github.com/Jpescudero/backtesting-engine/tree/main/src/strategies

  utils\
    # Utilidades compartidas

    __init__.py
      # Marca el paquete utils para imports relativos

    timing.py
      # Context manager para medir tiempos y loggear duración
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/utils/timing.py

    risk.py
      # Cálculo de tamaño dinámico de posición según SL/TP y riesgo permitido
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/utils/risk.py

  visualization\
    # En el futuro: dashboards, informes más complejos, etc.

    visualizacion.py
      # Boceto inicial para renderizados/plots desde notebooks
      GitHub: https://github.com/Jpescudero/backtesting-engine/blob/main/src/visualization/visualizacion.py

    # GitHub (carpeta): https://github.com/Jpescudero/backtesting-engine/tree/main/src/visualization


DATOS
-----
data\
  raw\
    darwinex\
      NDXm\
        # Datos crudos Darwinex (logs BID/ASK comprimidos)
        # Ejemplo de estructura esperada:
        #   BID\
        #     NDXm_BID_2021-04-09_14.log.gz
        #     ...
        #   ASK\
        #     NDXm_ASK_2021-04-09_14.log.gz
        #     ...

  parquet\
    ticks\
      # Parquets de ticks ya limpios y fusionados
      NDXm\
        2021\
          NDXm_2021-04-09_14.parquet
          NDXm_2021-04-09_15.parquet
          ...
        2022\
          ...
        # etc. por años

    bars_1m\
      NDXm\
        # (opcional, si decides guardar barras 1m también en parquet)
        # NDXm_2021_1m.parquet
        # NDXm_2022_1m.parquet
        # ...

  npz\
    NDXm\
      NDXm_all_1m.npz
        # barras 1m de todos los años en arrays NumPy (ts,o,h,l,c,v)
        # generado por csv_1m_to_npz.csv_1m_to_npz()

  other\
    barras_1min_NDXm_todos_anios.csv
      # CSV con todas las barras de 1 minuto para NDXm
      # generado por bars1m_to_excel.generate_1m_bars_csv()


RESEARCH
--------
research\
  ml\
    build_ml_dataset_ndxm.py
      # Script CLI para generar dataset ML (features + label) desde barras 1m NDXm.
    train_directional_model_ndxm.py
      # Entrena un modelo base (Gradient Boosting) con split temporal y guarda modelo + métricas.
  microstructure\
    study_opening_sweeps.py
      # Estudio estadístico de barridas de apertura (ventanas 08:55-10:00 y 14:55-16:00),
      # exporta métricas, trades y gráficos a reports/research/microstructure/.


NOTEBOOKS / REPORTS
-------------------
notebooks\
  # Notebooks de exploración y estudios

reports\
  # Informes generados (Excel, PNG, etc.)
  NDXm\
    backtest_NDXm_barrida_apertura.xlsx
    backtest_NDXm_barrida_apertura.json
    best_worst_trades.png


CONSTANTES DE RUTAS (paths.py)
------------------------------
# Definidas en src/config/paths.py

PROJECT_ROOT     = raíz del proyecto (donde está main.py)
SRC_DIR          = PROJECT_ROOT\src\
DATA_DIR         = PROJECT_ROOT\data\
NOTEBOOKS_DIR    = PROJECT_ROOT\notebooks\
REPORTS_DIR      = PROJECT_ROOT\reports\

CONFIG_DIR       = SRC_DIR\config\
DATA_MODULE_DIR  = SRC_DIR\data\
ENGINE_DIR       = SRC_DIR\engine\
STRATEGIES_DIR   = SRC_DIR\strategies\
VISUALIZATION_DIR= SRC_DIR\visualization\
ANALYTICS_DIR    = SRC_DIR\analytics\

RAW_DATA_DIR     = DATA_DIR\raw\
DARWINEX_RAW_DIR = RAW_DATA_DIR\darwinex\
PARQUET_DIR      = DATA_DIR\parquet\
PARQUET_TICKS_DIR= PARQUET_DIR\ticks\
PARQUET_BARS_1M_DIR = PARQUET_DIR\bars_1m\
NPZ_DIR          = DATA_DIR\npz\
NPZ_NDXM_DIR     = NPZ_DIR\NDXm\
OTHER_DATA_DIR   = DATA_DIR\other\
